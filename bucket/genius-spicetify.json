{
    "version": "2020-05-01T11.46.43",
    "description": "A Spicetify custom app that fetches lyrics for Spotify.",
    "homepage": "https://github.com/khanhas/genius-spicetify",
    "license": "Freeware",
    "depends": "spicetify-cli",
    "url": "https://github.com/khanhas/genius-spicetify/archive/master.zip",
    "hash": "f06cf23a83dc248c697cc16627dbcf300e6d9547ac66cc29aaef188c4b6a4eed",
    "notes": "See here to configure a Musixmatch user token: https://github.com/khanhas/genius-spicetify#musicxmatch",
    "installer": {
        "script": [
            "$spotify_path = get-spotify-path",
            "",
            "if (-not (Test-Path $spotify_path)) {",
            "    Write-Host \"Spotify must be installed to install $app.\" -Foreground Red",
            "    exit 1",
            "}",
            "",
            "$genius_dir = \"$env:USERPROFILE\\.spicetify\\CustomApps\\genius\"",
            "",
            "# Persist MusixMatch token",
            "if (Test-Path \"$genius_dir\\manifest.json\") { $musixmatchToken = (Select-String -Path \"$genius_dir\\manifest.json\" -Pattern 'UserToken.*\"(\\w*)\"' | Select-Object -First 1).Matches[0].Groups[1].Value }",
            "",
            "Remove-Item -ErrorAction Ignore -Recurse \"$genius_dir\"",
            "Copy-Item -Recurse \"$dir\\genius-spicetify-master\" -Destination \"$genius_dir\"",
            "",
            "if ($musixmatchToken) {",
            "    $content = (Get-Content \"$genius_dir\\manifest.json\") -replace '(UserToken.*)\"\\w*\"', \"`$1`\"$musixmatchToken`\"\"",
            "    [System.IO.File]::WriteAllLines(\"$genius_dir\\manifest.json\", $content) # UTF-8 no BOM is required",
            "}",
            "",
            "$spotify_running = Get-Process -ErrorAction Ignore -Name Spotify",
            "init-spicetify-config",
            "spicetify config custom_apps genius --quiet",
            "spicetify-apply",
            "if ($spotify_running) { Start-Process \"$spotify_path\" }"
        ]
    },
    "uninstaller": {
        "script": [
            "Remove-Item -Recurse -ErrorAction Ignore \"$env:USERPROFILE\\.spicetify\\CustomApps\\genius\"",
            "",
            "$spicetify_config = \"$env:USERPROFILE\\.spicetify\\config.ini\"",
            "",
            "if (Test-Path \"$spicetify_config\") {",
            "    $content = (Get-Content \"$spicetify_config\") -replace '(custom_apps.*)genius\\|?(.*)', '$1$2'",
            "    [System.IO.File]::WriteAllLines($spicetify_config, $content) # UTF-8 no BOM is required",
            "}",
            "",
            "init-spicetify-config-and-apply"
        ]
    },
    "checkver": {
        "url": "https://api.github.com/repos/khanhas/genius-spicetify/commits",
        "regex": "([\\d-]+T)(\\d+):(\\d+):(\\d+)",
        "replace": "$1$2.$3.$4"
    },
    "autoupdate": {
        "url": "https://github.com/khanhas/genius-spicetify/archive/master.zip"
    }
}
